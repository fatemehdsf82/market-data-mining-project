{% extends "admin/base.html" %}
{% load static %}

{% block title %}Market Analysis Dashboard | {{ site_title|default:"Django site admin" }}{% endblock %}

{% block extrahead %}
{{ block.super }}
<style>
    /* Override Django's default constrained layout */
    .admin #content {
        padding: 0 !important;
        margin: 0 !important;
        max-width: none !important;
        width: 100% !important;
        background: var(--bg-primary) !important;
    }
    
    /* Full-width dashboard container */
    .dashboard-container {
        width: 100%;
        min-height: 100vh;
        background: var(--bg-primary);
        padding: var(--space-8);
        box-sizing: border-box;
    }
    
    /* Hero section with gradient background */
    .dashboard-hero {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        border-radius: var(--radius-2xl);
        padding: var(--space-12);
        margin-bottom: var(--space-8);
        color: white;
        position: relative;
        overflow: hidden;
    }
    
    .dashboard-hero::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1.5" fill="rgba(255,255,255,0.05)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        opacity: 0.3;
    }
    
    .hero-content {
        position: relative;
        z-index: 1;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: var(--space-8);
        align-items: center;
    }
    
    .hero-title {
        font-size: 3rem;
        font-weight: 800;
        margin: 0 0 var(--space-4) 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .hero-subtitle {
        font-size: 1.25rem;
        opacity: 0.9;
        margin: 0;
        font-weight: 400;
    }
    
    .hero-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-4);
        min-width: 300px;
    }
    
    .hero-stat {
        text-align: center;
        padding: var(--space-4);
        background: rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-xl);
        backdrop-filter: blur(10px);
    }
    
    .hero-stat-value {
        font-size: 2rem;
        font-weight: 700;
        display: block;
    }
    
    .hero-stat-label {
        font-size: 0.875rem;
        opacity: 0.8;
        margin-top: var(--space-1);
    }
    
    /* Modern metrics grid */
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: var(--space-6);
        margin-bottom: var(--space-12);
    }
    
    .metric-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-2xl);
        padding: var(--space-8);
        position: relative;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: var(--shadow-lg);
        backdrop-filter: blur(20px);
    }
    
    .metric-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--gradient-primary);
        border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
    }
    
    .metric-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: var(--shadow-2xl), 0 25px 50px rgba(37, 99, 235, 0.15);
        border-color: var(--primary-light);
    }
    
    .metric-icon {
        font-size: 3rem;
        background: var(--gradient-primary);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: var(--space-4);
        display: block;
        filter: drop-shadow(0 4px 8px rgba(37, 99, 235, 0.3));
    }
    
    .metric-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: var(--space-2);
        font-family: 'Inter', sans-serif;
    }
    
    .metric-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: var(--space-3);
    }
    
    .metric-trend {
        display: inline-flex;
        align-items: center;
        gap: var(--space-1);
        padding: var(--space-2) var(--space-3);
        border-radius: var(--radius-lg);
        font-size: 0.875rem;
        font-weight: 600;
    }
    
    .metric-trend.positive {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
    }
    
    .metric-trend.negative {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger-color);
    }
    
    /* Analysis tools section */
    .tools-section {
        margin-bottom: var(--space-12);
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-8);
    }
    
    .section-title {
        font-size: 2.25rem;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: var(--space-4);
    }
    
    .section-title i {
        font-size: 2rem;
        color: var(--primary-color);
    }
    
    .tools-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: var(--space-8);
    }
    
    .tool-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-2xl);
        padding: var(--space-10);
        position: relative;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: var(--shadow-lg);
        backdrop-filter: blur(20px);
    }
    
    .tool-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--gradient-primary);
        transform: scaleX(0);
        transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
    }
    
    .tool-card:hover::before {
        transform: scaleX(1);
    }
    
    .tool-card:hover {
        transform: translateY(-12px) scale(1.02);
        box-shadow: var(--shadow-2xl), 0 25px 50px rgba(37, 99, 235, 0.15);
        border-color: var(--primary-light);
        background: var(--card-hover);
    }
    
    .tool-icon {
        font-size: 4rem;
        margin-bottom: var(--space-6);
        filter: drop-shadow(0 4px 8px rgba(37, 99, 235, 0.3));
    }
    
    .tool-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: var(--space-4);
        font-family: 'Inter', sans-serif;
    }
    
    .tool-description {
        color: var(--text-secondary);
        font-size: 1.125rem;
        line-height: 1.7;
        margin-bottom: var(--space-8);
    }
    
    .tool-actions {
        display: flex;
        gap: var(--space-4);
    }
    
    /* Modern button system */
    .btn-modern {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-3);
        padding: var(--space-4) var(--space-8);
        border: 2px solid transparent;
        border-radius: var(--radius-xl);
        font-weight: 700;
        font-size: 1rem;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        min-height: 56px;
        backdrop-filter: blur(10px);
        font-family: inherit;
        white-space: nowrap;
    }
    
    .btn-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .btn-modern:hover::before {
        left: 100%;
    }
    
    .btn-primary-modern {
        background: var(--gradient-primary);
        color: white;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        box-shadow: var(--shadow-lg);
    }
    
    .btn-primary-modern:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: var(--shadow-2xl), 0 15px 35px rgba(37, 99, 235, 0.3);
        text-decoration: none;
        color: white;
    }
    
    .btn-outline-modern {
        background: transparent;
        border: 2px solid var(--primary-color);
        color: var(--primary-color);
        backdrop-filter: blur(10px);
    }
    
    .btn-outline-modern:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-2px);
        text-decoration: none;
    }
    
    /* Charts and insights section */
    .insights-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: var(--space-8);
        margin-bottom: var(--space-12);
    }
    
    .chart-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-2xl);
        padding: var(--space-8);
        box-shadow: var(--shadow-lg);
        backdrop-filter: blur(20px);
    }
    
    .chart-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: var(--space-6);
        display: flex;
        align-items: center;
        gap: var(--space-3);
    }
    
    .chart-container {
        position: relative;
        height: 350px;
    }
    
    /* Activity feed */
    .activity-item {
        display: flex;
        align-items: flex-start;
        gap: var(--space-4);
        padding: var(--space-4);
        border-radius: var(--radius-lg);
        transition: all 0.3s ease;
        margin-bottom: var(--space-3);
    }
    
    .activity-item:hover {
        background: var(--hover-bg);
        transform: translateX(4px);
    }
    
    .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        font-size: 1.125rem;
        color: white;
    }
    
    .activity-icon.success { background: var(--gradient-success); }
    .activity-icon.info { background: var(--gradient-info); }
    .activity-icon.warning { background: var(--gradient-warning); }
    
    .activity-content {
        flex: 1;
    }
    
    .activity-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--space-1);
    }
    
    .activity-time {
        color: var(--text-light);
        font-size: 0.875rem;
    }
    
    /* Enhanced Tool Cards */
    .enhanced-tool-card {
        border: 2px solid var(--border-color) !important;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
    }
    
    .enhanced-tool-card:hover {
        border-color: var(--primary-color) !important;
        box-shadow: 0 20px 40px rgba(124, 58, 237, 0.15) !important;
    }
    
    .enhanced-title {
        color: var(--text-primary) !important;
        font-weight: 800 !important;
        font-size: 1.5rem !important;
        margin-bottom: var(--space-4) !important;
    }
    
    .enhanced-description {
        color: var(--text-secondary) !important;
        font-weight: 500 !important;
        line-height: 1.7 !important;
        font-size: 1rem !important;
    }
    
    .modern-icon {
        font-size: 3.5rem !important;
        margin-bottom: var(--space-6) !important;
        filter: drop-shadow(0 4px 8px rgba(124, 58, 237, 0.3)) !important;
    }
    
    /* Responsive design */
    @media (max-width: 1024px) {
        .dashboard-container { padding: var(--space-6); }
        .hero-content { grid-template-columns: 1fr; gap: var(--space-6); }
        .hero-title { font-size: 2.5rem; }
        .insights-grid { grid-template-columns: 1fr; }
        .tools-grid { grid-template-columns: 1fr; }
    }
    
    @media (max-width: 768px) {
        .dashboard-container { padding: var(--space-4); }
        .hero-title { font-size: 2rem; }
        .section-title { font-size: 1.75rem; }
        .metrics-grid { grid-template-columns: 1fr; }
        .hero-stats { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Hero Section -->
    <div class="dashboard-hero">
        <div class="hero-content">
            <div>
                <h1 class="hero-title">Market Intelligence Platform</h1>
                <p class="hero-subtitle">Advanced analytics and insights for Dunnhumby retail data</p>
            </div>
            <div class="hero-stats">
                <div class="hero-stat">
                    <span class="hero-stat-value">1.05M</span>
                    <span class="hero-stat-label">Transactions</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-value">92.3K</span>
                    <span class="hero-stat-label">Products</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-value">2,497</span>
                    <span class="hero-stat-label">Customers</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-value">$2.8M</span>
                    <span class="hero-stat-label">Revenue</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Key Metrics -->
    <div class="metrics-grid">
        <div class="metric-card">
            <i class="metric-icon fas fa-shopping-cart"></i>
            <div class="metric-value">1,048,569</div>
            <div class="metric-label">Total Transactions</div>
            <div class="metric-trend positive">
                <i class="fas fa-arrow-up"></i> +12.5%
            </div>
        </div>
        <div class="metric-card">
            <i class="metric-icon fas fa-boxes"></i>
            <div class="metric-value">92,353</div>
            <div class="metric-label">Unique Products</div>
            <div class="metric-trend positive">
                <i class="fas fa-arrow-up"></i> +8.2%
            </div>
        </div>
        <div class="metric-card">
            <i class="metric-icon fas fa-users"></i>
            <div class="metric-value">2,497</div>
            <div class="metric-label">Active Customers</div>
            <div class="metric-trend positive">
                <i class="fas fa-arrow-up"></i> +15.3%
            </div>
        </div>
        <div class="metric-card">
            <i class="metric-icon fas fa-dollar-sign"></i>
            <div class="metric-value">$2.84M</div>
            <div class="metric-label">Total Revenue</div>
            <div class="metric-trend positive">
                <i class="fas fa-arrow-up"></i> +18.7%
            </div>
        </div>
    </div>
    
    <!-- Analysis Tools -->
    <div class="tools-section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-analytics"></i>
                Analytics Tools
            </h2>
        </div>
        
        <div class="tools-grid">
            {% if analysis_tools %}
                {% for tool in analysis_tools %}
                <div class="tool-card">
                    <div class="tool-icon">{{ tool.icon }}</div>
                    <h3 class="tool-title">{{ tool.title }}</h3>
                    <p class="tool-description">{{ tool.description }}</p>
                    <div class="tool-actions">
                        <a href="{{ tool.url }}" class="btn-modern btn-primary-modern">
                            <i class="fas fa-rocket"></i> Launch Analysis
                        </a>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="tool-card enhanced-tool-card">
                    <div class="tool-icon modern-icon">📊</div>
                    <h3 class="tool-title enhanced-title">Shopping Basket Analysis</h3>
                    <p class="tool-description enhanced-description">Analyze shopping baskets, top products, and purchasing patterns with advanced market basket analysis algorithms for retail insights.</p>
                    <div class="tool-actions">
                        <a href="/dunnhumby-admin/basket-analysis/" class="btn-modern btn-primary-modern">
                            <i class="fas fa-rocket"></i> Launch Analysis
                        </a>
                    </div>
                </div>
                
                <div class="tool-card enhanced-tool-card">
                    <div class="tool-icon modern-icon">🔗</div>
                    <h3 class="tool-title enhanced-title">Association Rules Mining</h3>
                    <p class="tool-description enhanced-description">Generate and analyze market basket association rules using Apriori algorithm for product recommendation insights and cross-selling strategies.</p>
                    <div class="tool-actions">
                        <a href="/dunnhumby-admin/association-rules/" class="btn-modern btn-primary-modern">
                            <i class="fas fa-rocket"></i> Launch Analysis
                        </a>
                    </div>
                </div>
                
                <div class="tool-card enhanced-tool-card">
                    <div class="tool-icon modern-icon">👥</div>
                    <h3 class="tool-title enhanced-title">Customer Segmentation</h3>
                    <p class="tool-description enhanced-description">Perform RFM analysis and create behavioral customer segments for targeted marketing strategies and personalized customer experiences.</p>
                    <div class="tool-actions">
                        <a href="/dunnhumby-admin/customer-segments/" class="btn-modern btn-primary-modern">
                            <i class="fas fa-rocket"></i> Launch Analysis
                        </a>
                    </div>
                </div>
                
                <div class="tool-card enhanced-tool-card">
                    <div class="tool-icon modern-icon">⚙️</div>
                    <h3 class="tool-title enhanced-title">Database Management</h3>
                    <p class="tool-description enhanced-description">Advanced database manipulation, CRUD operations, and data quality management tools for comprehensive data control and analytics preparation.</p>
                    <div class="tool-actions">
                        <a href="/dunnhumby-admin/data-manipulation/" class="btn-modern btn-primary-modern">
                            <i class="fas fa-rocket"></i> Launch Tool
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Insights Dashboard -->
    <div class="insights-grid">
        <div class="chart-card">
            <h3 class="chart-title">
                <i class="fas fa-chart-line"></i>
                Market Trends Overview
            </h3>
            <div class="chart-container">
                <canvas id="trendsChart"></canvas>
            </div>
        </div>
        
        <div class="chart-card">
            <h3 class="chart-title">
                <i class="fas fa-bell"></i>
                Recent Activity
            </h3>
            <div style="max-height: 350px; overflow-y: auto;">
                <div class="activity-item">
                    <div class="activity-icon success">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">Association rules analysis completed</div>
                        <div class="activity-time">45 new patterns discovered • 2 minutes ago</div>
                    </div>
                </div>
                
                <div class="activity-item">
                    <div class="activity-icon info">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">Customer segmentation updated</div>
                        <div class="activity-time">156 customers re-classified • 15 minutes ago</div>
                    </div>
                </div>
                
                <div class="activity-item">
                    <div class="activity-icon warning">
                        <i class="fas fa-shopping-basket"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">Basket analysis refreshed</div>
                        <div class="activity-time">Top 100 combinations updated • 1 hour ago</div>
                    </div>
                </div>
                
                <div class="activity-item">
                    <div class="activity-icon success">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">Data quality check completed</div>
                        <div class="activity-time">99.8% data integrity • 3 hours ago</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Create modern trends chart
    const ctx = document.getElementById('trendsChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [
                {
                    label: 'Sales Volume',
                    data: [65, 78, 90, 81, 95, 108],
                    borderColor: 'rgba(37, 99, 235, 1)',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 3,
                    pointBackgroundColor: 'rgba(37, 99, 235, 1)',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 3,
                    pointRadius: 6
                },
                {
                    label: 'Customer Acquisition',
                    data: [28, 35, 42, 48, 52, 61],
                    borderColor: 'rgba(16, 185, 129, 1)',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 3,
                    pointBackgroundColor: 'rgba(16, 185, 129, 1)',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 3,
                    pointRadius: 6
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 20,
                        font: {
                            family: 'Inter',
                            size: 14,
                            weight: '600'
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleFont: { family: 'Inter', size: 14, weight: '600' },
                    bodyFont: { family: 'Inter', size: 13 },
                    cornerRadius: 12,
                    displayColors: true,
                    mode: 'index',
                    intersect: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)',
                        drawBorder: false
                    },
                    ticks: {
                        font: { family: 'Inter', size: 12 },
                        color: 'rgba(0, 0, 0, 0.6)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        font: { family: 'Inter', size: 12, weight: '500' },
                        color: 'rgba(0, 0, 0, 0.6)'
                    }
                }
            },
            interaction: {
                intersect: false,
                mode: 'index'
            }
        }
    });
});

// Preview functionality
function showPreview(toolName) {
    alert(`Preview for ${toolName} - This feature will show a quick overview of the analysis capabilities and sample results.`);
}

// Enhanced hover effects
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.metric-card, .tool-card');
    
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-8px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
    
    // Smooth scroll for internal links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});
</script>
{% endblock %}