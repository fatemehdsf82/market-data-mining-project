{% extends "admin/base.html" %}
{% load static %}

{% block title %}{{ title }} | {{ site_title|default:"Django site admin" }}{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="module">
        <h2>Database Manipulation & Management</h2>
        
        {% if result_message %}
        <div class="alert alert-success">
            <strong>Success:</strong> {{ result_message }}
        </div>
        {% endif %}
        
        <div class="action-section">
            <h3>Data Processing Actions</h3>
            
            <div class="action-grid">
                <div class="action-card">
                    <h4>Refresh Basket Analysis</h4>
                    <p>Recalculate basket analysis data from transaction records</p>
                    <form method="post" action="">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="refresh_basket_analysis">
                        <button type="submit" class="btn btn-primary">Refresh Analysis</button>
                    </form>
                </div>
                
                <div class="action-card">
                    <h4>Generate Customer Segments</h4>
                    <p>Perform RFM analysis and create customer segments</p>
                    <form method="post" action="">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="generate_segments">
                        <button type="submit" class="btn btn-success">Generate Segments</button>
                    </form>
                </div>
                
                <div class="action-card">
                    <h4>Clean Transaction Data</h4>
                    <p>Remove or fix inconsistent transaction records</p>
                    <form method="post" action="">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="clean_data">
                        <button type="submit" class="btn btn-warning">Clean Data</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="dashboard-stats">
            <h3>Database Statistics</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>{{ data_stats.total_transactions|default:0 }}</h4>
                    <p>Total Transactions</p>
                </div>
                <div class="stat-card">
                    <h4>{{ data_stats.total_products|default:0 }}</h4>
                    <p>Total Products</p>
                </div>
                <div class="stat-card">
                    <h4>{{ data_stats.total_households|default:0 }}</h4>
                    <p>Total Households</p>
                </div>
                <div class="stat-card">
                    <h4>{{ data_stats.total_campaigns|default:0 }}</h4>
                    <p>Total Campaigns</p>
                </div>
                <div class="stat-card">
                    <h4>{{ data_stats.basket_analyses|default:0 }}</h4>
                    <p>Basket Analyses</p>
                </div>
                <div class="stat-card">
                    <h4>{{ data_stats.association_rules|default:0 }}</h4>
                    <p>Association Rules</p>
                </div>
                <div class="stat-card">
                    <h4>{{ data_stats.customer_segments|default:0 }}</h4>
                    <p>Customer Segments</p>
                </div>
            </div>
        </div>

        <div class="info-box">
            <h4>Data Manipulation Guidelines</h4>
            <ul>
                <li><strong>Refresh Basket Analysis:</strong> Updates pre-calculated basket statistics from raw transaction data</li>
                <li><strong>Generate Customer Segments:</strong> Runs RFM analysis to categorize customers into behavioral segments</li>
                <li><strong>Clean Data:</strong> Identifies and corrects data inconsistencies in transaction records</li>
            </ul>
            <p><strong>Note:</strong> These operations may take several minutes depending on data size. Processing is limited to sample sizes for performance.</p>
        </div>
    </div>
</div>

<style>
.action-section {
    background-color: #f0f8ff;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.action-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 15px;
}

.action-card {
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    text-align: center;
}

.action-card h4 {
    color: #417690;
    margin-bottom: 10px;
}

.action-card p {
    color: #666;
    margin-bottom: 15px;
    line-height: 1.4;
}

.dashboard-stats {
    margin-bottom: 20px;
    padding: 20px;
    background-color: #f8f9fa;
    border-radius: 8px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.stat-card {
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    border: 1px solid #e0e0e0;
}

.stat-card h4 {
    font-size: 2em;
    color: #417690;
    margin: 0 0 10px 0;
}

.stat-card p {
    color: #666;
    margin: 0;
    font-weight: 500;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s;
}

.btn-primary {
    background-color: #417690;
    color: white;
}

.btn-primary:hover {
    background-color: #2e5266;
}

.btn-success {
    background-color: #28a745;
    color: white;
}

.btn-success:hover {
    background-color: #1e7e34;
}

.btn-warning {
    background-color: #ffc107;
    color: #212529;
}

.btn-warning:hover {
    background-color: #e0a800;
}

.alert {
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 4px;
}

.alert-success {
    background-color: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
}

.info-box {
    background-color: #e7f3ff;
    padding: 20px;
    border-left: 4px solid #417690;
    margin-top: 20px;
}

.info-box h4 {
    margin-top: 0;
    color: #417690;
}

.info-box ul {
    margin: 15px 0;
    padding-left: 20px;
}

.info-box li {
    margin-bottom: 8px;
    line-height: 1.4;
}
</style>
{% endblock %}